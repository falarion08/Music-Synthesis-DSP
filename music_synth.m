fsamp = 44100;
flute_key = [52,49,54,54,57,56,54,56,56,57,61,54,52];
flute_dur = [2.75,1,2,0.25,0.25,0.25,0.75,3,0.75,0.75,0.75,3.5,4];
yy =[];
delay = [4,9];
intro_delay = [0.05,0.05];
array_counter = 1;


%%flute intro
for i=1:length(flute_key)

if(ismember(i,delay))
    yy = [yy, 0*(0:1/fsamp:intro_delay(array_counter))];
    array_counter = array_counter + 1;
end
freq = key2freq(flute_key(i));
piece = clarinet(freq,flute_dur(i),fsamp);
yy = [yy,piece];
end

% 1 second delay
yy = [yy,0*(0:1/fsamp:1)];

% End intro

%%verse 1 part 1
yy2 = [];
piano_notes = [40,49,47,45,49,47,45,49,47,45,40,40,52,47,45,52,44,44,52,47,44,45];
piano_dur = [0.35,0.6,0.6,0.6,0.6,1.75,0.6,0.6,0.6,0.6,2.1,0.6,0.6,0.6,0.6,0.6,2.1,0.6,0.6,0.6,0.6,0.6,3];
delay_index = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21];
verse_delay = [0.25,0.01,0.01,0.01,0.02,0.02,0.02,0.02,0.02,0.02,0.01,0.03,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.001,0.01];

array_counter = 1;
for i=1:length(piano_notes)

if(ismember(i,delay_index))
    yy2 = [yy2, 0*(0:1/fsamp:verse_delay(array_counter))];

    array_counter = array_counter + 1;
end
piece = key2note(1,piano_notes(i),piano_dur(i),fsamp);
yy2 = [yy2,piece];
end
yy= [yy,yy2];


% 0.05 second delay
yy = [yy,0*(0:1/fsamp:0.05)];
% soundsc(yy,fsamp);
%%end verse1 part1

% verse1 part2
yy2 = [];
notes = [47,51,49,47,45,49,47,49,52,49,52,54,51,47,44,40,42,51,56,56,52,54,49,51,45,42,44,40,47,49,45,49,47,47,44];
notes_dur = [0.75,0.35,0.45,1,0.45,0.45,1,0.45,0.45,0.45,0.35,1,0.45,0.45,0.45,0.5,0.75,0.45,0.45,0.45,0.35,0.75,0.5,0.5,0.75,0.45,0.5,0.45,0.45,0.35,1.5,1.5,0.25,0.25,2];
delay_index = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34];
verse_delay = [0.01,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.005,0.05,0.07,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.01,0.05,0.01,0.05];
array_counter = 1;

for i=1:length(notes)

if(ismember(i,delay_index))
    yy2 = [yy2, 0*(0:1/fsamp:verse_delay(array_counter))];
    array_counter = array_counter + 1;
end
piece = key2note(1,notes(i),notes_dur(i),fsamp);
yy2 = [yy2,piece];
end

yy = [yy,yy2];

%end verse1 part2

%verse2 part1
yy2 = [];
notes = [57,57,40,49,47,45,49,47,45,49,47,45,40,56,57,56,54,52,52,47,45,52,44,44,49,47,44,45,47,52,49,47,45,49,49,52,49,52,54,49,52,47,45,40,44,54,56,56,52,54,49,51,51,49,47];
notes_dur = [0.35,0.75,0.5,0.5,0.5,0.5,0.5,1,0.75,0.5,0.5,0.5,1.5,0.17,0.17,0.17,0.17,0.17,0.25,0.5,0.5,0.5,1.35,0.35,0.25,1,0.5,1,0.15,0.25,1,0.25,0.25,1.25,0.35,0.5,0.35,0.5,1.25,0.5,0.35,0.35,0.35,0.5,1,0.35,0.4,0.4,0.4,1.5,0.25,0.75,0.35,0.4,2.5];
delay_index = 1:length(notes);
verse_delay = [0.001,0.05,0.75,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.01,0.05,0.01,0.01,0.03,0.05,0.1,0.05,0.05,0.05,0.5,0.05,0.05,0.05,0.05,0.2,0.01,0.05,0.05,0.01,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.01,0.05,0.05,0.05];
array_counter = 1;

for i=1:length(notes)

if(ismember(i,delay_index))
    yy2 = [yy2, 0*(0:1/fsamp:verse_delay(array_counter))];
    array_counter = array_counter + 1;
end
freq = key2freq(notes(i));
piece = brass(freq,notes_dur(i),fsamp);
yy2 = [yy2,piece];
end

yy = [yy,yy2];  
%end of verse2 part1


%Chorus

yy2 = [];
notes = [47,47,52,51,49,47,59,57,52,51,52,57,54,49,50,49,50,49,52,50,49,50,54,56,52,52,52,52,52,50,49,49,47,49,47,45,45,45,45,42,45,45,42,43];
notes_dur = [0.75,0.25,0.25,0.25,0.18,0.18,0.45,1.5,0.25,0.25,0.25,0.45,1,0.1,0.1,0.75,0.75,0.25,1.25,0.2,0.75,0.45,0.45,1.5, 0.25,0.25,0.45,0.25,0.25,0.25,0.25,0.35,0.25,0.5,0.75,0.25,1.5,0.35,0.35,0.65,0.35,0.35,0.65,0.75];
delay_index = 1:length(notes);
verse_delay = [0.05,0.002,0.002,0.002,0.002,0.002,0.002,0.02,0.75,0.002,0.002,0.002,0.075,0.05,0.01,0.01,0.01,0.01,0.01,0.05,0.01,0.01,0.01,0.01,0.05,0.05,0.01,0.05,0.05,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.5,0.002,0.002,0.002,0.002,0.002,0.002];
array_counter = 1; 

for i=1:length(notes)

if(ismember(i,delay_index))
    yy2 = [yy2, 0*(0:1/fsamp:verse_delay(array_counter))];
    array_counter = array_counter + 1;
end
freq = key2freq(notes(i));
piece = clarinet(freq,notes_dur(i),fsamp);
yy2 = [yy2,piece];
end

% Simple echo
echo = echo_filt(yy2,fsamp);
yy = [yy,echo];

%Chorus addition


yy2 = [];
notes = [44,49,50,49,50,51,52,52,59,57,52,56,57,56,57,56,54,55,47,52,54,56,58,59,57,55,54,52,51,51,47,51,54,52,54,52,50,52,50,51,51,51,52,54,57,52,54,56,49,52,57,57,56,52,49,45,44,49, 45,45,45,42,45,45,42,43,44];
notes_dur = [0.2,0.2,0.2,0.02,0.2,0.3,1,0.25,0.65,0.65,0.45,0.2,0.65,0.65,0.2,0.3,0.25, 0.35,0.2,0.2,0.2,0.25,0.2,0.25,0.65,0.2,0.2,0.2,0.35,0.25,0.2,0.25,0.2, 0.2,0.2,0.2,0.2,0.65,0.25, 0.2,0.25,0.2,0.25,0.2,0.25,0.65,0.65,0.65,0.2,0.2,0.65,0.2, 0.25,0.25,0.25,0.25,0.65,1.5, 0.45,0.2,0.35,0.35,0.35,0.35,0.35,0.65,4];
delay_index = 1:length(notes);
verse_delay = [0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.01,0.01,0.01,0.01,0.075,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01, 0.05,0.01,0.02,0.01,0.02,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.1,0.02,0.02,0.02,0.05,0.02,0.01, 0.5,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0];
array_counter = 1; 

for i=1:length(notes)

if(ismember(i,delay_index))
    yy2 = [yy2, 0*(0:1/fsamp:verse_delay(array_counter))];
    array_counter = array_counter + 1;
end
freq = key2freq(notes(i));
piece = clarinet(freq,notes_dur(i),fsamp);
yy2 = [yy2,piece];
end

echo_rev = echo_reverb(yy2,fsamp);

yy = [yy,echo_rev];

% soundsc(yy, fsamp);

audiowrite('Le_Festin_Music_Synth.mp3',yy,fsamp);

function freq = key2freq(keynum)
freq = 440*2^((keynum - 49)/12);
end

